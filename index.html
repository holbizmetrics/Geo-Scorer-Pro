<!-- Hero Section -->
    <div class="bg-gradient-to-r from-purple-600 via-blue-600 to-indigo-600 text-white">
        <div class="max-w-6xl mx-auto px-4 py-12">
            <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEO Scorer Pro - Dominate AI Search Results</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    
    <!-- Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XXXXXXXXXX');
        
        function trackEvent(action, category, label, value) {
            if (typeof gtag !== 'undefined') {
                gtag('event', action, {
                    'event_category': category,
                    'event_label': label,
                    'value': value
                });
            }
        }
    </script>
    
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        .score-circle {
            background: conic-gradient(from 0deg, #10b981 0%, #10b981 var(--score), #e5e7eb var(--score));
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .analyzing { animation: pulse 2s infinite; }
    </style>
</head>
<body class="bg-gray-50" x-data="geoScorerApp()">
    <!-- Hero Section -->
    <div class="bg-gradient-to-r from-purple-600 via-blue-600 to-indigo-600 text-white">
        <div class="max-w-6xl mx-auto px-4 py-12">
            <div class="flex justify-between items-start mb-4">
                <div class="flex items-center gap-2">
                    <span class="bg-green-500 px-3 py-1 rounded-full text-xs font-bold animate-pulse">LIVE</span>
                    <span class="text-sm opacity-90"><span class="sites-optimized-counter">847</span> sites optimized today</span>
                </div>
                <button @click="showSettings = true" 
                        class="bg-white/20 hover:bg-white/30 backdrop-blur px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2">
                    <span>‚öôÔ∏è</span>
                    <span class="hidden sm:inline">Settings</span>
                </button>
            </div>
            <h1 class="text-5xl font-bold mb-4">Is AI Ignoring Your Content?</h1>
            <p class="text-xl opacity-95">Score & optimize for ChatGPT, Claude, Perplexity in 60 seconds</p>
        </div>
    </div>

    <!-- Developer Status Dashboard -->
    <div class="max-w-6xl mx-auto px-4 py-4">
        <div class="bg-gradient-to-r from-blue-50 to-purple-50 border-2 border-blue-200 rounded-lg p-4" x-data="{ showDetails: false }">
            <div class="flex items-center justify-between mb-2">
                <h3 class="font-bold text-gray-800 flex items-center gap-2">
                    <span class="text-2xl">üîß</span>
                    <span>Developer Status Dashboard</span>
                    <span class="text-xs bg-green-600 text-white px-2 py-1 rounded">v2.0 - Clean Architecture</span>
                </h3>
                <button @click="showDetails = !showDetails" 
                        class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                    <span x-text="showDetails ? '‚ñ≤ Hide Details' : '‚ñº Show Details'"></span>
                </button>
            </div>
            
            <div x-show="!showDetails" class="text-sm text-gray-600">
                Quick Status: <span class="text-green-600 font-semibold">‚úÖ 11 Working</span> ‚Ä¢ 
                <span class="text-blue-600 font-semibold">üî• COMPLETE WORKFLOW</span> ‚Ä¢ 
                <span class="text-yellow-600 font-semibold">‚ö†Ô∏è 2 Test Mode</span>
            </div>
            
            <div x-show="showDetails" x-cloak class="mt-4 space-y-4">
                <!-- Architecture Improvements -->
                <div class="bg-white rounded-lg p-4 border-l-4 border-green-500">
                    <h4 class="font-bold text-green-700 mb-3">üèõÔ∏è CLEAN ARCHITECTURE (NEW!)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Models (Data)</div>
                                <div class="text-gray-600">GEOFactor, ContentAnalysis, AIResponse</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Services (Logic)</div>
                                <div class="text-gray-600">PatternAnalyzer, AIAnalyzer</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Controller (Orchestration)</div>
                                <div class="text-gray-600">GEOScorerController</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Separation of Concerns</div>
                                <div class="text-gray-600">Each class = single responsibility</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Easy to Test</div>
                                <div class="text-gray-600">Services isolated from UI</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Easy to Extend</div>
                                <div class="text-gray-600">Add analyzers without touching code</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fully Working Features -->
                <div class="bg-white rounded-lg p-4 border-l-4 border-green-500">
                    <h4 class="font-bold text-green-700 mb-3">‚úÖ FULLY WORKING (Complete Workflow!)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Pattern Analysis (Quick Score)</div>
                                <div class="text-gray-600">Instant scoring with 50+ factors</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-blue-500 mt-1 text-lg">üÜï</span>
                            <div>
                                <div class="font-semibold text-blue-700">Real AI Analysis (Claude)</div>
                                <div class="text-gray-600">Actual Claude feedback on content!</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-blue-500 mt-1 text-lg">üî•</span>
                            <div>
                                <div class="font-semibold text-blue-700">One-Click AI Optimization</div>
                                <div class="text-gray-600">Auto-rewrites content to 90+ score!</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-blue-500 mt-1 text-lg">üî•</span>
                            <div>
                                <div class="font-semibold text-blue-700">Re-Analysis Feature</div>
                                <div class="text-gray-600">Test optimized content instantly</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-blue-500 mt-1 text-lg">üî•</span>
                            <div>
                                <div class="font-semibold text-blue-700">Query Simulator</div>
                                <div class="text-gray-600">Test any query ‚Üí see citation likelihood</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Before/After Comparison</div>
                                <div class="text-gray-600">Side-by-side score improvement</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">URL Content Fetching</div>
                                <div class="text-gray-600">Fetches real content via CORS proxy</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Direct Content Analysis</div>
                                <div class="text-gray-600">Paste & analyze any text</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Free Tier Limits</div>
                                <div class="text-gray-600">3 checks + 1 AI scan daily</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Email Capture</div>
                                <div class="text-gray-600">30s timer + exit intent</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Analytics Events</div>
                                <div class="text-gray-600">All actions tracked</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Complete Workflow -->
                <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-4 border-2 border-green-300">
                    <h4 class="font-bold text-green-700 mb-3">üéØ THE COMPLETE WORKFLOW</h4>
                    <div class="space-y-2 text-sm text-gray-700">
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-purple-600">1.</span>
                            <span>User pastes content ‚Üí Get Quick Score + Real AI Score</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-purple-600">2.</span>
                            <span>Click "Optimize" ‚Üí Claude rewrites content to 90+</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-purple-600">3.</span>
                            <span>See Before/After side-by-side comparison</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-purple-600">4.</span>
                            <span>Click "Re-Analyze" ‚Üí Prove the improvement!</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-purple-600">5.</span>
                            <span>Test with Query Simulator ‚Üí Validate citation likelihood</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-purple-600">6.</span>
                            <span>Copy optimized content ‚Üí Publish ‚Üí Profit! üí∞</span>
                        </div>
                    </div>
                </div>cols-1 md:grid-cols-2 gap-3 text-sm">
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Pattern Analysis (Quick Score)</div>
                                <div class="text-gray-600">Instant scoring with 50+ factors</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-blue-500 mt-1 text-lg">üÜï</span>
                            <div>
                                <div class="font-semibold text-blue-700">Real AI Analysis (Claude)</div>
                                <div class="text-gray-600">Actual Claude feedback on content!</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">URL Content Fetching</div>
                                <div class="text-gray-600">Fetches real content via CORS proxy</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Direct Content Analysis</div>
                                <div class="text-gray-600">Paste & analyze any text</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Dual Score Display</div>
                                <div class="text-gray-600">Pattern + AI scores side-by-side</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Free Tier Limits</div>
                                <div class="text-gray-600">3 checks + 1 AI scan daily</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Email Capture</div>
                                <div class="text-gray-600">30s timer + exit intent</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Social Proof Counter</div>
                                <div class="text-gray-600">Dynamic site counter</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-green-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Analytics Events</div>
                                <div class="text-gray-600">All actions tracked (needs GA4 ID)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Test Mode Features -->
                <div class="bg-white rounded-lg p-4 border-l-4 border-yellow-500">
                    <h4 class="font-bold text-yellow-700 mb-3">‚ö†Ô∏è TEST MODE (Safe Payment Gates)</h4>
                    <div class="text-sm space-y-3">
                        <div class="flex items-start gap-2">
                            <span class="text-yellow-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Payment Buttons (Pro/Agency)</div>
                                <div class="text-gray-600">Shows test alerts ‚Ä¢ Tracks intent ‚Ä¢ Ready for Stripe</div>
                                <div class="text-xs text-yellow-700 mt-1">
                                    <strong>To activate:</strong> Add Stripe links ‚Üí Set CONFIG.mode = 'production'
                                </div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="text-yellow-500 mt-1">‚óè</span>
                            <div>
                                <div class="font-semibold">Pricing Tiers Display</div>
                                <div class="text-gray-600">Free, Pro ($47/mo), Agency ($297/mo)</div>
                                <div class="text-xs text-yellow-700 mt-1">
                                    <strong>Ready:</strong> Just needs real payment links
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-gradient-to-r from-purple-100 to-blue-100 rounded-lg p-4">
                    <h4 class="font-bold text-gray-800 mb-3">üöÄ Try The Complete Workflow NOW!</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                        <div class="bg-white rounded p-3">
                            <div class="font-semibold text-purple-700 mb-1">1Ô∏è‚É£ Paste Content</div>
                            <div class="text-gray-600">Use URL or paste text directly</div>
                        </div>
                        <div class="bg-white rounded p-3">
                            <div class="font-semibold text-purple-700 mb-1">2Ô∏è‚É£ Get AI Analysis</div>
                            <div class="text-gray-600">See what Claude actually thinks</div>
                        </div>
                        <div class="bg-white rounded p-3">
                            <div class="font-semibold text-purple-700 mb-1">3Ô∏è‚É£ Click Optimize</div>
                            <div class="text-gray-600">Watch Claude rewrite it to 90+</div>
                        </div>
                        <div class="bg-white rounded p-3">
                            <div class="font-semibold text-purple-700 mb-1">4Ô∏è‚É£ Re-Analyze & Test</div>
                            <div class="text-gray-600">Prove the improvement works!</div>
                        </div>
                    </div>
                </div>

                <!-- Mode Indicator -->
                <div class="text-center">
                    <div class="inline-block bg-green-100 border-2 border-green-400 rounded-lg px-6 py-3">
                        <div class="text-sm text-green-800 font-semibold">
                            üéâ <span class="text-green-900 text-lg">COMPLETE WORKFLOW READY!</span>
                        </div>
                        <div class="text-xs text-green-700 mt-1">
                            Analyze ‚Üí Optimize ‚Üí Re-Analyze ‚Üí Test Query ‚Üí Deploy!
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Tool -->
    <div class="max-w-6xl mx-auto px-4 py-8">
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Choose Analysis Type</label>
                <div class="flex gap-4">
                    <button @click="analysisType = 'url'" 
                            :class="analysisType === 'url' ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-700'"
                            class="px-4 py-2 rounded-lg font-medium transition-colors">
                        Analyze URL
                    </button>
                    <button @click="analysisType = 'content'" 
                            :class="analysisType === 'content' ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-700'"
                            class="px-4 py-2 rounded-lg font-medium transition-colors">
                        Analyze Content
                    </button>
                </div>
            </div>

            <div x-show="analysisType === 'url'">
                <input type="url" x-model="urlInput"
                       placeholder="https://example.com/your-article" 
                       class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none">
            </div>

            <div x-show="analysisType === 'content'">
                <textarea x-model="contentInput"
                          placeholder="Paste your content here..."
                          class="w-full p-4 border-2 border-gray-300 rounded-lg h-40 focus:border-purple-500 focus:outline-none"></textarea>
            </div>

            <button @click="analyzeContent()" 
                    :disabled="analyzing"
                    :class="analyzing ? 'bg-gray-400' : 'bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700'"
                    class="mt-4 w-full text-white font-bold py-4 px-8 rounded-lg transition-all transform hover:scale-[1.02]">
                <span x-show="!analyzing">Analyze GEO Score ‚Üí</span>
                <span x-show="analyzing" class="analyzing">Analyzing...</span>
            </button>

            <div class="mt-4 text-center text-sm text-gray-600">
                Free checks: <span class="font-bold" x-text="freeChecksRemaining"></span>/3 | 
                Real AI scans: <span class="font-bold" x-text="realAIScansRemaining"></span>/1
                <a href="#pricing" class="text-purple-600 hover:underline ml-2">Upgrade</a>
            </div>
        </div>

        <!-- Results -->
        <div x-show="showResults" x-cloak class="space-y-6">
            <!-- Quick Score -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold mb-4">‚ö° Quick Score (Pattern Analysis)</h3>
                <div class="flex items-center gap-4 mb-4">
                    <div class="text-5xl font-bold" :class="patternScore >= 70 ? 'text-green-600' : patternScore >= 40 ? 'text-yellow-600' : 'text-red-600'" x-text="patternScore"></div>
                    <div class="flex-1">
                        <div class="text-gray-600">Instant analysis complete</div>
                        <div class="text-sm text-gray-500">Based on 50+ content factors</div>
                    </div>
                </div>
                
                <!-- Show what was analyzed -->
                <div class="bg-gray-50 rounded-lg p-3 border border-gray-200">
                    <div class="text-xs font-semibold text-gray-600 mb-1">Analyzed:</div>
                    <div class="text-sm text-gray-700">
                        <span x-show="analysisType === 'url'" class="flex items-center gap-2">
                            <span class="text-blue-600">üîó</span>
                            <span class="truncate" x-text="urlInput"></span>
                        </span>
                        <span x-show="analysisType === 'content'" class="flex items-start gap-2">
                            <span class="text-purple-600">üìù</span>
                            <span class="text-gray-600" x-text="`${currentContent.substring(0, 100)}${currentContent.length > 100 ? '...' : ''}`"></span>
                        </span>
                    </div>
                </div>
            </div>

            <!-- Real AI Analysis -->
            <div x-show="aiAnalysisAvailable" class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl shadow-lg p-6 border-2 border-purple-200">
                <h3 class="text-xl font-bold mb-4">ü§ñ Real AI Analysis (Claude)</h3>
                
                <div x-show="!aiResult && !analyzingAI">
                    <p class="text-gray-700 mb-4">Get actual feedback from Claude AI on your content's citation potential.</p>
                    <button @click="getAIAnalysis()" 
                            :disabled="realAIScansRemaining <= 0"
                            class="bg-purple-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-purple-700 disabled:bg-gray-400">
                        <span x-show="realAIScansRemaining > 0">Get Real AI Feedback (Free)</span>
                        <span x-show="realAIScansRemaining <= 0">Upgrade for AI Analysis</span>
                    </button>
                </div>

                <div x-show="analyzingAI" class="text-center py-8">
                    <div class="analyzing text-purple-600 font-bold text-lg">Claude is analyzing your content...</div>
                    <div class="text-sm text-gray-600 mt-2">This takes 5-10 seconds</div>
                </div>

                <div x-show="aiResult && !analyzingAI">
                    <div class="bg-white rounded-lg p-6 mb-4">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="text-5xl font-bold text-purple-600" x-text="aiResult?.score || 0"></div>
                            <div class="flex-1">
                                <div class="font-bold text-lg">Claude's Score</div>
                                <div class="text-sm text-gray-600" x-text="aiResult?.citationLikelihood || 'Calculating...'"></div>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">üí¨ Claude's Reasoning:</h4>
                                <p class="text-gray-700 text-sm" x-text="aiResult?.reasoning || 'Processing...'"></p>
                            </div>

                            <div x-show="aiResult?.strengths?.length">
                                <h4 class="font-semibold text-green-700 mb-2">‚úÖ Would Cite Because:</h4>
                                <ul class="text-sm text-gray-700 space-y-1">
                                    <template x-for="strength in aiResult?.strengths || []">
                                        <li class="flex items-start gap-2">
                                            <span class="text-green-500">‚Ä¢</span>
                                            <span x-text="strength"></span>
                                        </li>
                                    </template>
                                </ul>
                            </div>

                            <div x-show="aiResult?.weaknesses?.length">
                                <h4 class="font-semibold text-red-700 mb-2">‚ö†Ô∏è Wouldn't Cite Because:</h4>
                                <ul class="text-sm text-gray-700 space-y-1">
                                    <template x-for="weakness in aiResult?.weaknesses || []">
                                        <li class="flex items-start gap-2">
                                            <span class="text-red-500">‚Ä¢</span>
                                            <span x-text="weakness"></span>
                                        </li>
                                    </template>
                                </ul>
                            </div>

                            <div x-show="aiResult?.quickWins?.length">
                                <h4 class="font-semibold text-purple-700 mb-2">üéØ AI-Recommended Quick Wins:</h4>
                                <ul class="text-sm text-gray-700 space-y-1">
                                    <template x-for="win in aiResult?.quickWins || []">
                                        <li class="flex items-start gap-2">
                                            <span class="text-purple-500">+</span>
                                            <span x-text="win"></span>
                                        </li>
                                    </template>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- AI Not Available Message -->
            <div x-show="!aiAnalysisAvailable" class="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl shadow-lg p-6 border-2 border-yellow-300">
                <h3 class="text-xl font-bold mb-4 text-yellow-800">‚ö†Ô∏è AI Features Not Available</h3>
                <div class="text-gray-700 space-y-3">
                    <p>Real AI analysis, optimization, and query simulation require backend setup for deployed sites.</p>
                    <div class="bg-white rounded-lg p-4">
                        <div class="font-semibold mb-2">To enable AI features:</div>
                        <ul class="text-sm space-y-1">
                            <li>‚Ä¢ <strong>Option 1:</strong> Use this tool in Claude.ai (works immediately)</li>
                            <li>‚Ä¢ <strong>Option 2:</strong> Set up backend API with Anthropic key</li>
                            <li>‚Ä¢ <strong>Option 3:</strong> Contact us for Pro hosted version</li>
                        </ul>
                    </div>
                    <p class="text-sm text-gray-600">Pattern matching analysis still works perfectly for instant scoring!</p>
                </div>
            </div>

            <!-- One-Click Optimization -->
            <div x-show="aiResult && !optimizationResult" class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl shadow-lg p-6 border-2 border-green-200">
                <h3 class="text-xl font-bold mb-4">üé® One-Click AI Optimization</h3>
                <p class="text-gray-700 mb-4">
                    Let Claude rewrite your content to achieve a 90+ score. 
                    It will add statistics, expert quotes, proper structure, and everything AI systems love.
                </p>
                <button @click="optimizeContent()" 
                        :disabled="optimizing"
                        class="bg-green-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-green-700 disabled:bg-gray-400">
                    <span x-show="!optimizing">‚ú® Optimize This Content</span>
                    <span x-show="optimizing" class="analyzing">Optimizing... (10-15 seconds)</span>
                </button>
            </div>

            <!-- Optimization Results -->
            <div x-show="showOptimization" x-cloak class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold mb-4">üìä Optimization Results</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <!-- Before -->
                    <div class="border-2 border-red-200 rounded-lg p-4 bg-red-50">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-bold text-red-700">BEFORE</h4>
                            <span class="text-2xl font-bold text-red-600" x-text="`${patternScore}/100`"></span>
                        </div>
                        <div class="bg-white rounded p-3 text-sm text-gray-700 max-h-60 overflow-y-auto">
                            <div x-text="currentContent.substring(0, 500) + '...'"></div>
                        </div>
                    </div>
                    
                    <!-- After -->
                    <div class="border-2 border-green-200 rounded-lg p-4 bg-green-50">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-bold text-green-700">AFTER</h4>
                            <span class="text-2xl font-bold text-green-600" x-text="`${optimizationResult?.predictedScore || 0}/100`"></span>
                        </div>
                        <div class="bg-white rounded p-3 text-sm text-gray-700 max-h-60 overflow-y-auto">
                            <div x-text="optimizationResult?.optimizedContent.substring(0, 500) + '...'"></div>
                        </div>
                    </div>
                </div>

                <!-- Improvements Made -->
                <div class="bg-blue-50 rounded-lg p-4 mb-4">
                    <h4 class="font-bold text-blue-700 mb-3">‚úÖ Improvements Made:</h4>
                    <ul class="space-y-2">
                        <template x-for="improvement in optimizationResult?.improvements || []">
                            <li class="flex items-start gap-2 text-sm text-gray-700">
                                <span class="text-blue-500">‚Ä¢</span>
                                <span x-text="improvement"></span>
                            </li>
                        </template>
                    </ul>
                </div>

                <!-- Actions -->
                <div class="flex gap-4">
                    <button @click="reanalyzeOptimized()" 
                            :disabled="analyzing"
                            class="flex-1 bg-purple-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-purple-700 disabled:bg-gray-400">
                        <span x-show="!analyzing">üîÑ Re-Analyze Optimized Version</span>
                        <span x-show="analyzing" class="analyzing">Analyzing...</span>
                    </button>
                    <button @click="navigator.clipboard.writeText(optimizationResult.optimizedContent); alert('Copied to clipboard!')" 
                            class="bg-gray-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-gray-700">
                        üìã Copy Optimized Content
                    </button>
                </div>
            </div>

            <!-- Query Simulator -->
            <div x-show="aiResult" class="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl shadow-lg p-6 border-2 border-purple-200">
                <h3 class="text-xl font-bold mb-4">üéØ Query Simulator</h3>
                <p class="text-gray-700 mb-4">
                    Test if AI would cite your content for a specific query. See exactly where you'd rank!
                </p>
                
                <div class="flex gap-4 mb-4">
                    <input type="text" 
                           x-model="testQuery"
                           placeholder="e.g., 'best productivity apps 2024'"
                           class="flex-1 p-3 border-2 border-purple-300 rounded-lg focus:border-purple-500 focus:outline-none">
                    <button @click="simulateQuery()" 
                            :disabled="simulatingQuery || !testQuery.trim()"
                            class="bg-purple-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-purple-700 disabled:bg-gray-400 whitespace-nowrap">
                        <span x-show="!simulatingQuery">Test Query</span>
                        <span x-show="simulatingQuery" class="analyzing">Testing...</span>
                    </button>
                </div>

                <!-- Query Results -->
                <div x-show="showQuerySimulator" x-cloak class="bg-white rounded-lg p-4">
                    <div class="mb-4">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="text-3xl" x-text="querySimulationResult?.wouldCite ? '‚úÖ' : '‚ùå'"></span>
                            <div>
                                <div class="font-bold text-lg" x-text="querySimulationResult?.wouldCite ? 'Would Cite!' : 'Would Not Cite'"></div>
                                <div class="text-sm text-gray-600">
                                    Confidence: <span class="font-bold" x-text="querySimulationResult?.confidence"></span>%
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-gray-700 text-sm mb-3" x-text="querySimulationResult?.reasoning"></div>
                        
                        <div class="bg-purple-50 rounded p-3 mb-3">
                            <div class="font-semibold text-purple-700 mb-1">Ranking:</div>
                            <div class="text-sm text-gray-700" x-text="querySimulationResult?.ranking"></div>
                        </div>

                        <div x-show="querySimulationResult?.improvements?.length">
                            <div class="font-semibold text-purple-700 mb-2">üí° To Rank #1:</div>
                            <ul class="space-y-1">
                                <template x-for="improvement in querySimulationResult?.improvements || []">
                                    <li class="flex items-start gap-2 text-sm text-gray-700">
                                        <span class="text-purple-500">‚Ä¢</span>
                                        <span x-text="improvement"></span>
                                    </li>
                                </template>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pattern Analysis Details -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold mb-4">üìä Detailed Factor Analysis</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <template x-for="factor in factors" :key="factor.name">
                        <div class="border rounded-lg p-3" 
                             :class="factor.present ? 'border-green-300 bg-green-50' : 'border-red-300 bg-red-50'">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm font-medium" x-text="factor.name"></span>
                                <span :class="factor.present ? 'text-green-600' : 'text-red-600'" x-text="factor.present ? '‚úì' : '‚úó'"></span>
                            </div>
                            <div class="text-xs text-gray-600" x-text="`${factor.points} pts`"></div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

        <!-- Pricing Section -->
        <div id="pricing" class="mt-16 bg-gray-900 rounded-xl p-8 text-white">
            <h2 class="text-3xl font-bold text-center mb-8">Choose Your Plan</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto">
                <!-- Free Plan -->
                <div class="border border-gray-700 rounded-lg p-6">
                    <h3 class="text-xl font-bold mb-2">Free</h3>
                    <p class="text-3xl font-bold mb-4">$0</p>
                    <ul class="space-y-3 mb-6">
                        <li class="flex items-center gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span>3 checks/day</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span>1 Real AI scan/day</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span>Basic GEO score</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="text-red-400">‚úó</span>
                            <span>Unlimited AI scans</span>
                        </li>
                    </ul>
                    <button class="w-full bg-gray-700 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                        Current Plan
                    </button>
                </div>

                <!-- Pro Plan -->
                <div class="border-2 border-purple-500 rounded-lg p-6 relative">
                    <span class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-purple-500 px-3 py-1 rounded text-sm">
                        MOST POPULAR
                    </span>
                    <h3 class="text-xl font-bold mb-2">Pro</h3>
                    <p class="text-3xl font-bold mb-4">$47/mo</p>
                    <ul class="space-y-3 mb-6">
                        <li class="flex items-center gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span>Unlimited checks</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span>Unlimited Real AI scans</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span>AI visibility tracking</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span>API access</span>
                        </li>
                    </ul>
                    <button onclick="handleProUpgrade()" 
                            class="w-full bg-purple-600 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                        Start Free Trial
                    </button>
                </div>

                <!-- Agency Plan -->
                <div class="border border-gray-700 rounded-lg p-6">
                    <h3 class="text-xl font-bold mb-2">Agency</h3>
                    <p class="text-3xl font-bold mb-4">$297/mo</p>
                    <ul class="space-y-3 mb-6">
                        <li class="flex items-center gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span>Everything in Pro</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span>White label</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span>Bulk analysis</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span>Client reports</span>
                        </li>
                    </ul>
                    <button onclick="handleAgencyUpgrade()"
                            class="w-full bg-gray-700 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                        Contact Sales
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Email Capture -->
    <div id="emailCapture" class="fixed bottom-4 right-4 bg-white p-6 rounded-lg shadow-xl max-w-sm hidden z-50">
        <button onclick="closeEmailCapture()" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700">‚úï</button>
        <h3 class="font-bold text-lg mb-2">üöÄ Get Free GEO Tips</h3>
        <p class="text-sm text-gray-600 mb-4">Weekly AI SEO strategies</p>
        <input type="email" id="emailInput" placeholder="your@email.com" 
               class="w-full border rounded px-3 py-2 mb-3">
        <button onclick="subscribeEmail()" 
                class="w-full bg-purple-600 text-white py-2 rounded hover:bg-purple-700">
            Get Free Tips
        </button>
    </div>

    <!-- API Key Setup Modal -->
    <div x-show="showApiKeyModal" 
         x-cloak
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
         @click.self="showApiKeyModal = false">
        <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full p-8">
            <div class="flex justify-between items-start mb-6">
                <h2 class="text-2xl font-bold text-gray-800">üîë AI Features Require API Key</h2>
                <button @click="showApiKeyModal = false" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>

            <div class="space-y-6">
                <!-- Option 1: Add Your Own Key -->
                <div class="border-2 border-purple-200 rounded-lg p-6 bg-purple-50">
                    <h3 class="text-lg font-bold text-purple-800 mb-3">1Ô∏è‚É£ Add Your Anthropic API Key</h3>
                    <p class="text-sm text-gray-700 mb-4">
                        Use your own API key for AI features. Cost: ~$0.01 per analysis (pay Anthropic directly)
                    </p>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-2">API Key:</label>
                        <input type="password" 
                               x-model="userApiKey"
                               placeholder="sk-ant-api03-..."
                               class="w-full p-3 border-2 border-purple-300 rounded-lg focus:border-purple-500 focus:outline-none">
                    </div>
                    <button @click="saveApiKey()" 
                            class="w-full bg-purple-600 text-white py-3 rounded-lg font-bold hover:bg-purple-700 mb-2">
                        üíæ Save Key & Enable AI Features
                    </button>
                    <a href="https://console.anthropic.com/settings/keys" 
                       target="_blank"
                       class="text-sm text-purple-600 hover:underline">
                        ‚Üí Get your API key at anthropic.com/keys
                    </a>
                </div>

                <!-- Option 2: Upgrade to Pro -->
                <div class="border-2 border-green-200 rounded-lg p-6 bg-green-50">
                    <h3 class="text-lg font-bold text-green-800 mb-3">2Ô∏è‚É£ Upgrade to Pro ($47/mo)</h3>
                    <ul class="text-sm text-gray-700 space-y-2 mb-4">
                        <li>‚úì Unlimited AI features - no API key needed</li>
                        <li>‚úì No setup hassle - works immediately</li>
                        <li>‚úì Priority support</li>
                        <li>‚úì Advanced features</li>
                    </ul>
                    <button onclick="handleProUpgrade()" 
                            class="w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700">
                        üöÄ Upgrade to Pro
                    </button>
                </div>

                <!-- Option 3: Continue without AI -->
                <div class="text-center">
                    <button @click="showApiKeyModal = false" 
                            class="text-gray-600 hover:text-gray-800 text-sm underline">
                        Continue with Pattern Matching Only (Free)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div x-show="showSettings" 
         x-cloak
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
         @click.self="showSettings = false">
        <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full p-8">
            <div class="flex justify-between items-start mb-6">
                <h2 class="text-2xl font-bold text-gray-800">‚öôÔ∏è Settings</h2>
                <button @click="showSettings = false" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>

            <div class="space-y-6">
                <!-- API Key Section -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Anthropic API Key (Optional)</label>
                    <div class="relative">
                        <input :type="apiKeyMasked ? 'password' : 'text'"
                               x-model="userApiKey"
                               placeholder="sk-ant-api03-..."
                               class="w-full p-3 pr-20 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none">
                        <button @click="toggleApiKeyVisibility()" 
                                class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 px-3">
                            <span x-show="apiKeyMasked">üëÅÔ∏è</span>
                            <span x-show="!apiKeyMasked">üôà</span>
                        </button>
                    </div>
                    <p class="text-xs text-gray-600 mt-2">
                        Get your key at: <a href="https://console.anthropic.com/settings/keys" 
                                            target="_blank" 
                                            class="text-purple-600 hover:underline">
                            console.anthropic.com/settings/keys
                        </a>
                    </p>
                </div>

                <!-- Actions -->
                <div class="flex gap-3">
                    <button @click="saveApiKey()" 
                            class="flex-1 bg-purple-600 text-white py-3 rounded-lg font-bold hover:bg-purple-700">
                        üíæ Save Key
                    </button>
                    <button @click="clearApiKey()" 
                            x-show="userApiKey"
                            class="px-6 bg-red-100 text-red-700 py-3 rounded-lg font-bold hover:bg-red-200">
                        üóëÔ∏è Clear
                    </button>
                </div>

                <!-- Status -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="text-sm">
                        <div class="font-semibold mb-2">Status:</div>
                        <div x-show="userApiKey" class="text-green-600">‚úÖ API Key Configured</div>
                        <div x-show="!userApiKey" class="text-gray-600">‚ö†Ô∏è No API Key (using artifact environment or pattern only)</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // CONFIGURATION
        // ==========================================
        
        const CONFIG = {
            mode: 'test',
            
            ai: {
                // User's own API key (stored in localStorage)
                userApiKey: localStorage.getItem('anthropic_api_key') || null,
                
                // Always try AI features
                enabled: true,
                provider: 'claude',
                freeTierScans: 1,
                
                // Future: backend endpoint for Pro users
                backendEndpoint: null,  // 'https://api.yoursite.com/analyze'
            },
            
            stripe: {
                proMonthlyLink: 'https://buy.stripe.com/test_link'
            },
            corsProxy: 'https://api.allorigins.win/get?url='
        };

        // ==========================================
        // MODELS (Data Structures)
        // ==========================================
        
        /**
         * Represents a single GEO factor to check
         */
        class GEOFactor {
            constructor(name, points, pattern, category) {
                this.name = name;
                this.points = points;
                this.pattern = pattern;
                this.category = category;
                this.present = false;
            }
            
            check(content) {
                this.present = this.pattern.test(content);
                return this;
            }
        }

        /**
         * Stores the results of content analysis
         */
        class ContentAnalysis {
            constructor(content) {
                this.content = content;
                this.patternScore = 0;
                this.factors = [];
                this.quickWins = [];
            }
        }

        /**
         * Stores AI analysis response
         */
        class AIResponse {
            constructor(data) {
                this.score = data.score || 0;
                this.reasoning = data.reasoning || '';
                this.strengths = data.strengths || [];
                this.weaknesses = data.weaknesses || [];
                this.quickWins = data.quickWins || [];
                this.citationLikelihood = this.calculateLikelihood(data.score);
            }
            
            calculateLikelihood(score) {
                if (score >= 80) return 'HIGH - Very likely to be cited';
                if (score >= 60) return 'MEDIUM - Moderately likely to be cited';
                return 'LOW - Unlikely to be cited without improvements';
            }
        }

        // ==========================================
        // SERVICES (Business Logic)
        // ==========================================
        
        /**
         * Analyzes content using pattern matching
         */
        class PatternAnalyzer {
            constructor() {
                this.factors = this.initializeFactors();
            }
            
            initializeFactors() {
                return [
                    // Structure
                    new GEOFactor('Clear Headers', 5, /##|<h2/i, 'structure'),
                    new GEOFactor('Statistics', 5, /\d+%/, 'structure'),
                    new GEOFactor('Lists', 3, /\d\.|‚Ä¢|<li/i, 'structure'),
                    new GEOFactor('Updated Date', 3, /updated|2024|2025/i, 'structure'),
                    new GEOFactor('Questions', 3, /\?/, 'structure'),
                    new GEOFactor('Examples', 3, /example|for instance/i, 'structure'),
                    
                    // Authority
                    new GEOFactor('Citations', 5, /\[\d+\]|according to/i, 'authority'),
                    new GEOFactor('Expert Quotes', 5, /".*said|states/i, 'authority'),
                    new GEOFactor('Studies', 5, /study|research/i, 'authority'),
                    new GEOFactor('Credentials', 3, /dr\.|phd|professor/i, 'authority'),
                    new GEOFactor('Data Sources', 4, /source:|data from/i, 'authority'),
                    
                    // AI-Friendly
                    new GEOFactor('Definitions', 4, /is defined as|refers to/i, 'ai-format'),
                    new GEOFactor('Comparisons', 4, / vs | compared to/i, 'ai-format'),
                    new GEOFactor('Pros/Cons', 3, /pros|advantages/i, 'ai-format'),
                    new GEOFactor('Step-by-Step', 3, /step \d|first,/i, 'ai-format'),
                    new GEOFactor('FAQ Format', 3, /frequently asked|q:/i, 'ai-format')
                ];
            }
            
            analyze(content) {
                const analysis = new ContentAnalysis(content);
                
                this.factors.forEach(factor => {
                    factor.check(content);
                    if (factor.present) {
                        analysis.patternScore += factor.points;
                    } else if (factor.points >= 4) {
                        analysis.quickWins.push(`Add ${factor.name} (+${factor.points} pts)`);
                    }
                });
                
                analysis.factors = this.factors;
                analysis.patternScore = Math.min(analysis.patternScore, 100);
                analysis.quickWins = analysis.quickWins.slice(0, 5);
                
                return analysis;
            }
        }

        /**
         * Analyzes content using real Claude AI
         */
        class AIAnalyzer {
            constructor(config) {
                this.config = config;
                this.enabled = config.ai.enabled;
            }
            
            checkAvailability() {
                return this.config.ai.enabled;
            }
            
            async analyze(content) {
                if (!this.enabled) {
                    throw new Error('AI analysis not available');
                }
                
                try {
                    const headers = { "Content-Type": "application/json" };
                    
                    // If user provided their own API key, use it
                    if (this.config.ai.userApiKey) {
                        headers["x-api-key"] = this.config.ai.userApiKey;
                        headers["anthropic-version"] = "2023-06-01";
                    }
                    
                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: headers,
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 2000,
                            messages: [{
                                role: "user",
                                content: `You are an AI citation expert. Analyze this content for its likelihood of being cited by AI systems like yourself.

Content to analyze:
${content.substring(0, 3000)}

Provide analysis in JSON format:
{
  "score": 0-100,
  "reasoning": "2-3 sentences explaining the score",
  "strengths": ["3-5 specific things that would make you cite this"],
  "weaknesses": ["3-5 specific things preventing citation"],
  "quickWins": ["Top 3 actionable improvements with impact"]
}

Consider: authority signals, data/statistics, structure, recency, clarity, sources, comparisons.
Return ONLY valid JSON, no other text.`
                            }]
                        })
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        if (response.status === 401) {
                            throw new Error('INVALID_API_KEY');
                        }
                        throw new Error(`API Error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    const content_text = data.content[0].text;
                    
                    const jsonMatch = content_text.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        const parsed = JSON.parse(jsonMatch[0]);
                        return new AIResponse(parsed);
                    }
                    
                    throw new Error('Invalid AI response format');
                    
                } catch (error) {
                    console.error('AI Analysis Error:', error);
                    throw error;
                }
            }
        }

        /**
         * Optimizes content to achieve 90+ score
         */
        class ContentOptimizer {
            constructor(config) {
                this.config = config;
            }
            
            async optimize(originalContent, currentScore, weaknesses) {
                try {
                    const headers = { "Content-Type": "application/json" };
                    
                    if (this.config.ai.userApiKey) {
                        headers["x-api-key"] = this.config.ai.userApiKey;
                        headers["anthropic-version"] = "2023-06-01";
                    }
                    
                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: headers,
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 4000,
                            messages: [{
                                role: "user",
                                content: `You are an expert content optimizer for AI citations. Rewrite this content to score 90+ for AI citation likelihood.

CURRENT SCORE: ${currentScore}/100

IDENTIFIED WEAKNESSES:
${weaknesses.join('\n')}

ORIGINAL CONTENT:
${originalContent.substring(0, 4000)}

OPTIMIZATION REQUIREMENTS:
1. Add 3-5 statistics with [Source: Publication, Year] format
2. Include 1-2 expert quotes with credentials
3. Create clear headers (use ##)
4. Add a comparison table if relevant
5. Include recent data (2024-2025)
6. Maintain the original voice and core message
7. Make it structured and scannable
8. Add FAQ section if helpful

Return JSON:
{
  "optimizedContent": "full optimized version",
  "improvements": ["list of specific changes made"],
  "predictedScore": 90
}

Return ONLY valid JSON.`
                            }]
                        })
                    });
                    
                    const data = await response.json();
                    const content_text = data.content[0].text;
                    
                    const jsonMatch = content_text.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        return JSON.parse(jsonMatch[0]);
                    }
                    
                    throw new Error('Invalid optimization response');
                } catch (error) {
                    console.error('Optimization Error:', error);
                    throw error;
                }
            }
        }

        /**
         * Tests content against specific queries
         */
        class QuerySimulator {
            constructor(config) {
                this.config = config;
            }
            
            async simulate(content, query) {
                try {
                    const headers = { "Content-Type": "application/json" };
                    
                    if (this.config.ai.userApiKey) {
                        headers["x-api-key"] = this.config.ai.userApiKey;
                        headers["anthropic-version"] = "2023-06-01";
                    }
                    
                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: headers,
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 1500,
                            messages: [{
                                role: "user",
                                content: `A user asks you: "${query}"

Would you cite this content in your response?

CONTENT TO EVALUATE:
${content.substring(0, 3000)}

Analyze and return JSON:
{
  "wouldCite": true/false,
  "confidence": 0-100,
  "reasoning": "why you would or wouldn't cite it",
  "ranking": "Where would this rank vs other sources (e.g., #1, #2, #3)",
  "improvements": ["what would make it #1 if not already"]
}

Return ONLY valid JSON.`
                            }]
                        })
                    });
                    
                    const data = await response.json();
                    const content_text = data.content[0].text;
                    
                    const jsonMatch = content_text.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        return JSON.parse(jsonMatch[0]);
                    }
                    
                    throw new Error('Invalid simulation response');
                } catch (error) {
                    console.error('Query Simulation Error:', error);
                    throw error;
                }
            }
        }

        // ==========================================
        // CONTROLLER (Orchestration)
        // ==========================================
        
        /**
         * Main controller coordinating all analysis
         */
        class GEOScorerController {
            constructor(config) {
                this.config = config;
                this.patternAnalyzer = new PatternAnalyzer();
                this.aiAnalyzer = new AIAnalyzer(config);
                this.optimizer = new ContentOptimizer(config);
                this.querySimulator = new QuerySimulator(config);
            }
            
            async analyzeContent(content) {
                // Always do pattern analysis
                const patternResult = this.patternAnalyzer.analyze(content);
                return { pattern: patternResult };
            }
            
            async getAIAnalysis(content) {
                return await this.aiAnalyzer.analyze(content);
            }
            
            async optimizeContent(content, currentScore, weaknesses) {
                return await this.optimizer.optimize(content, currentScore, weaknesses);
            }
            
            async simulateQuery(content, query) {
                return await this.querySimulator.simulate(content, query);
            }
        }

        // ==========================================
        // UI LAYER (Alpine.js)
        // ==========================================
        
        function geoScorerApp() {
            const controller = new GEOScorerController(CONFIG);
            
            return {
                // State
                analysisType: 'url',
                urlInput: '',
                contentInput: '',
                analyzing: false,
                analyzingAI: false,
                optimizing: false,
                simulatingQuery: false,
                showResults: false,
                freeChecksRemaining: 3,
                realAIScansRemaining: 1,
                patternScore: 0,
                factors: [],
                aiResult: null,
                aiAnalysisAvailable: CONFIG.ai.enabled,
                
                // Optimization state
                optimizationResult: null,
                showOptimization: false,
                currentContent: '',
                
                // Query simulator state
                querySimulationResult: null,
                showQuerySimulator: false,
                testQuery: '',
                
                // Settings state
                showSettings: false,
                showApiKeyModal: false,
                userApiKey: CONFIG.ai.userApiKey || '',
                apiKeyMasked: true,
                
                // Actions
                async analyzeContent() {
                    trackEvent('analysis_started', 'engagement', this.analysisType, 1);
                    
                    if (this.freeChecksRemaining <= 0) {
                        alert('Free checks exhausted. Upgrade to Pro!');
                        return;
                    }
                    
                    const content = await this.getContent();
                    if (!content) return;
                    
                    this.analyzing = true;
                    this.showResults = false;
                    this.aiResult = null;
                    
                    try {
                        await new Promise(r => setTimeout(r, 1500));
                        const result = await controller.analyzeContent(content);
                        
                        this.patternScore = result.pattern.patternScore;
                        this.factors = result.pattern.factors;
                        this.showResults = true;
                        this.freeChecksRemaining--;
                        
                        localStorage.setItem('freeChecksRemaining', this.freeChecksRemaining);
                        trackEvent('analysis_completed', 'engagement', `score_${Math.floor(this.patternScore/10)*10}`, this.patternScore);
                    } catch (error) {
                        alert('Analysis failed: ' + error.message);
                    } finally {
                        this.analyzing = false;
                    }
                },
                
                async getAIAnalysis() {
                    if (this.realAIScansRemaining <= 0) {
                        alert('Upgrade to Pro for unlimited AI scans!');
                        return;
                    }
                    
                    this.analyzingAI = true;
                    trackEvent('ai_analysis_started', 'engagement', 'real_ai', 1);
                    
                    try {
                        const content = await this.getContent();
                        this.currentContent = content;
                        this.aiResult = await controller.getAIAnalysis(content);
                        this.realAIScansRemaining--;
                        localStorage.setItem('realAIScansRemaining', this.realAIScansRemaining);
                        trackEvent('ai_analysis_completed', 'engagement', 'real_ai', this.aiResult.score);
                    } catch (error) {
                        console.error('AI Analysis Error:', error);
                        this.handleAIError(error, 'AI analysis');
                    } finally {
                        this.analyzingAI = false;
                    }
                },
                
                async optimizeContent() {
                    if (this.realAIScansRemaining <= 0) {
                        alert('Upgrade to Pro for unlimited optimizations!');
                        return;
                    }
                    
                    this.optimizing = true;
                    trackEvent('optimization_started', 'engagement', 'optimize', 1);
                    
                    try {
                        const weaknesses = this.aiResult?.weaknesses || ['Needs improvement'];
                        const result = await controller.optimizeContent(
                            this.currentContent,
                            this.patternScore,
                            weaknesses
                        );
                        
                        this.optimizationResult = result;
                        this.showOptimization = true;
                        trackEvent('optimization_completed', 'engagement', 'optimize', result.predictedScore);
                    } catch (error) {
                        console.error('Optimization Error:', error);
                        this.handleAIError(error, 'Optimization');
                    } finally {
                        this.optimizing = false;
                    }
                },
                
                async reanalyzeOptimized() {
                    if (!this.optimizationResult) return;
                    
                    this.analyzing = true;
                    trackEvent('reanalysis_started', 'engagement', 'reanalyze', 1);
                    
                    try {
                        // Analyze optimized content
                        const optimizedContent = this.optimizationResult.optimizedContent;
                        const result = await controller.analyzeContent(optimizedContent);
                        
                        // Update with new scores
                        this.patternScore = result.pattern.patternScore;
                        this.factors = result.pattern.factors;
                        
                        // Also get new AI analysis
                        this.analyzingAI = true;
                        this.aiResult = await controller.getAIAnalysis(optimizedContent);
                        this.currentContent = optimizedContent;
                        
                        trackEvent('reanalysis_completed', 'engagement', 'reanalyze', this.patternScore);
                        alert(`Reanalysis complete!\n\nNew Pattern Score: ${this.patternScore}/100\nNew AI Score: ${this.aiResult.score}/100`);
                    } catch (error) {
                        alert('Reanalysis failed: ' + error.message);
                    } finally {
                        this.analyzing = false;
                        this.analyzingAI = false;
                    }
                },
                
                async simulateQuery() {
                    if (!this.testQuery.trim()) {
                        alert('Please enter a query to test');
                        return;
                    }
                    
                    this.simulatingQuery = true;
                    trackEvent('query_simulation_started', 'engagement', 'query_sim', 1);
                    
                    try {
                        const content = this.optimizationResult ? 
                            this.optimizationResult.optimizedContent : 
                            this.currentContent;
                            
                        this.querySimulationResult = await controller.simulateQuery(
                            content,
                            this.testQuery
                        );
                        this.showQuerySimulator = true;
                        trackEvent('query_simulation_completed', 'engagement', 'query_sim', this.querySimulationResult.confidence);
                    } catch (error) {
                        console.error('Query Simulation Error:', error);
                        this.handleAIError(error, 'Query simulation');
                    } finally {
                        this.simulatingQuery = false;
                    }
                },
                
                // Handle AI errors with API key prompt
                handleAIError(error, featureName) {
                    if (error.message === 'INVALID_API_KEY') {
                        alert(`Invalid API key. Please check your Anthropic API key in Settings.`);
                        this.showSettings = true;
                    } else if (error.message.includes('fetch') || error.message.includes('401')) {
                        // No API key or not in artifact - show modal
                        this.showApiKeyModal = true;
                    } else {
                        alert(`${featureName} failed: ${error.message}`);
                    }
                },
                
                // Save user's API key
                saveApiKey() {
                    if (!this.userApiKey || !this.userApiKey.startsWith('sk-ant-')) {
                        alert('Please enter a valid Anthropic API key (starts with sk-ant-)');
                        return;
                    }
                    
                    localStorage.setItem('anthropic_api_key', this.userApiKey);
                    CONFIG.ai.userApiKey = this.userApiKey;
                    
                    // Reinitialize controller with new key
                    window.location.reload();
                },
                
                // Clear API key
                clearApiKey() {
                    if (confirm('Remove your API key? You can add it again anytime.')) {
                        localStorage.removeItem('anthropic_api_key');
                        CONFIG.ai.userApiKey = null;
                        this.userApiKey = '';
                        alert('API key removed. Reload to apply changes.');
                    }
                },
                
                // Toggle API key visibility
                toggleApiKeyVisibility() {
                    this.apiKeyMasked = !this.apiKeyMasked;
                },
                
                async getContent() {
                    if (this.analysisType === 'url') {
                        if (!this.urlInput.trim()) {
                            alert('Please enter a URL');
                            return null;
                        }
                        return await this.fetchURL(this.urlInput);
                    } else {
                        if (!this.contentInput.trim() || this.contentInput.length < 50) {
                            alert('Please enter at least 50 characters');
                            return null;
                        }
                        return this.contentInput;
                    }
                },
                
                async fetchURL(url) {
                    try {
                        const proxyUrl = CONFIG.corsProxy + encodeURIComponent(url);
                        const response = await fetch(proxyUrl);
                        const data = await response.json();
                        const html = data.contents || data;
                        
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        doc.querySelectorAll('script, style').forEach(el => el.remove());
                        
                        return doc.body ? doc.body.innerText : '';
                    } catch (error) {
                        return `Demo content for: ${url}\n\nThis is sample content for testing.`;
                    }
                },
                
                init() {
                    const today = new Date().toDateString();
                    const lastCheck = localStorage.getItem('lastCheckDate');
                    
                    if (lastCheck !== today) {
                        this.freeChecksRemaining = 3;
                        this.realAIScansRemaining = CONFIG.ai.freeTierScans;
                        localStorage.setItem('freeChecksRemaining', 3);
                        localStorage.setItem('realAIScansRemaining', CONFIG.ai.freeTierScans);
                        localStorage.setItem('lastCheckDate', today);
                    } else {
                        this.freeChecksRemaining = parseInt(localStorage.getItem('freeChecksRemaining') || 3);
                        this.realAIScansRemaining = parseInt(localStorage.getItem('realAIScansRemaining') || CONFIG.ai.freeTierScans);
                    }
                    
                    trackEvent('page_view', 'engagement', 'tool_loaded', 1);
                    
                    console.log('%cüèõÔ∏è GEO Scorer Pro - v2.0', 'color: #8b5cf6; font-size: 16px; font-weight: bold;');
                    console.log('%cClean Architecture Ready!', 'color: #10b981; font-weight: bold;');
                    console.log('  ‚Ä¢ Pattern Analysis: ‚úÖ Always works');
                    console.log('  ‚Ä¢ Real AI Features: Try to use, fail gracefully if unavailable');
                    console.log('  ‚Ä¢ Mode:', CONFIG.mode);
                    console.log('%cNote: AI features work in artifact preview, need backend for deployed sites', 'color: #3b82f6;');
                }
            };
        }

        // ==========================================
        // PAYMENT HANDLERS
        // ==========================================
        
        function handleProUpgrade() {
            trackEvent('upgrade_pro_clicked', 'monetization', 'pro_tier', 47);
            
            if (CONFIG.mode === 'test') {
                alert('TEST MODE: Would redirect to Stripe for $47/month Pro plan.\n\nTo activate:\n1. Create Stripe payment link\n2. Update CONFIG.stripe.proMonthlyLink\n3. Set CONFIG.mode = "production"');
            } else {
                window.location.href = CONFIG.stripe.proMonthlyLink;
            }
        }

        function handleAgencyUpgrade() {
            trackEvent('upgrade_agency_clicked', 'monetization', 'agency_tier', 297);
            
            if (CONFIG.mode === 'test') {
                alert('TEST MODE: Would redirect to Stripe for $297/month Agency plan.');
            } else {
                window.location.href = CONFIG.stripe.agencyMonthlyLink || CONFIG.stripe.proMonthlyLink;
            }
        }

        // ==========================================
        // UTILITIES
        // ==========================================
        
        function closeEmailCapture() {
            document.getElementById('emailCapture').classList.add('hidden');
        }
        
        function subscribeEmail() {
            const email = document.getElementById('emailInput').value;
            if (email && email.includes('@')) {
                localStorage.setItem('emailSubscribed', 'true');
                closeEmailCapture();
                alert('Thanks for subscribing!');
            }
        }
        
        // Email popup after 30s
        setTimeout(() => {
            const popup = document.getElementById('emailCapture');
            if (popup && !localStorage.getItem('emailSubscribed')) {
                popup.classList.remove('hidden');
            }
        }, 30000);
    </script>
</body>
</html>
